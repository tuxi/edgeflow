syntax = "proto3";
package marketdata;

option go_package = "./protobuf;pb";

// --- æœåŠ¡ç«¯æ¨é€çš„æœ€å°æ•°æ®å•å…ƒ ---

// Ticker æ•°æ® (ä»·æ ¼ç½‘å…³ä½¿ç”¨)
message TickerUpdate {
  string inst_id = 1;      // å¸ç§ç¬¦å·ï¼Œä¾‹å¦‚ BTC-USDT
  string last_price = 2;   // æœ€æ–°æˆäº¤ä»·æ ¼
  string vol_24h = 3;      // 24å°æ—¶æˆäº¤é‡ (å•ä½å¸)
  string vol_ccy_24h = 4;  // 24å°æ—¶æˆäº¤é¢ (å•ä½è®¡ä»·å¸)
  string high_24h = 5;     // 24å°æ—¶æœ€é«˜ä»·
  string low_24h = 6;      // 24å°æ—¶æœ€ä½ä»·
  string open_24h = 7;     // 24å°æ—¶å¼€ç›˜ä»·æ ¼
  double change_24h = 8;   // 24å°æ—¶æ¶¨è·Œå¹…ï¼ˆ%ï¼‰
  string ask_px = 9;       // å–ä¸€ä»·
  string ask_sz = 10;      // å–ä¸€é‡
  string bid_px = 11;      // ä¹°ä¸€ä»·
  string bid_sz = 12;      // ä¹°ä¸€é‡
  int64 ts = 13;           // æ—¶é—´æˆ³ (æ¯«ç§’çº§)
}

// æ‰¹é‡å¤šä¸ªå¸ç§çš„ticker
message TickerBatch {
  repeated TickerUpdate tickers = 1;
}

// K çº¿æ•°æ® (è®¢é˜…ç½‘å…³ä½¿ç”¨)
message WsKlineUpdate {
  string inst_id = 1;      // å¸ç§ç¬¦å·
  string time_period = 2;  // K çº¿å‘¨æœŸï¼Œä¾‹å¦‚ "15m"
  bool confirm = 3;        // æ˜¯å¦å·²æ”¶ç›˜

  // å†…åµŒ K çº¿è¯¦ç»†æ•°æ®
  message KlineData {
    int64 timestamp = 1; // Kçº¿èµ·å§‹æ—¶é—´ (æ¯«ç§’çº§)
    string open = 2;
    string close = 3;
    string high = 4;
    string low = 5;
    string vol = 6;     // æˆäº¤é‡ (å¸ä¸ºå•ä½)
    string vol_ccy = 7; // æˆäº¤é¢ (è®¡ä»·å¸ä¸ºå•ä½)
  }

  KlineData data = 4; // K çº¿è¯¦ç»†æ•°æ®
}

// é”™è¯¯ä¿¡æ¯ (æ‰€æœ‰ç½‘å…³é€šç”¨)
message ErrorMessage {
  string action = 1; // "error"
  map<string, string> data = 2; // é€šç”¨æ•°æ®/é”®å€¼å¯¹é”™è¯¯ä¿¡æ¯
}

// äº¤æ˜“å¯¹åˆ—è¡¨æ›´æ–° (è®¢é˜…ç½‘å…³æˆ– Ticker ç½‘å…³ä½¿ç”¨)
message InstrumentListUpdate {
  repeated string sorted_inst_ids = 1; // æ’åºåçš„ InstID åˆ—è¡¨
}

// å¸ç§/äº¤æ˜“å¯¹å…ƒæ•°æ®æ›´æ–°
message InstrumentUpdate {
  repeated string new_instruments = 1;     // æ–°ä¸Šæ¶çš„ InstID åˆ—è¡¨
  repeated string delisted_instruments = 2; // å·²ä¸‹æ¶çš„ InstID åˆ—è¡¨
}

// å¸ç§äº¤æ˜“æ‰€æ•°æ®
message CryptoExchange {
  uint32 id = 1;
  string code = 2;
  string name = 3;
  string status = 4;
  string api_endpoint = 5;
  string country = 6;
}

// æ’åºåˆ—å¥½ä¸€ç»„è´§å¸id
message SortUpdate {
  // æ’åºç±»å‹
  string sort_by = 1;
  // ä½¿ç”¨ repeated å…³é”®å­—è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„/åˆ—è¡¨
  repeated string sorted_inst_ids = 2;
}

// åŠ å¯†è´§å¸çš„æ ‡ç­¾
message CryptoTag {
  uint32 id = 1;
  string name = 2;
  string description = 3;
}

// äº¤æ˜“æ•°æ®ç»“æ„ä½“
message CryptoInstrumentTradingItem {
    CryptoInstrumentMetadata instrument_metadata = 1;
    TickerUpdate ticker_update = 2;
}

// ä¸€ç»„å¸¦æœ‰æœ€æ–°ä»·æ ¼çš„å¸ç§ä¿¡æ¯
message CryptoInstrumentTradingArray {
  repeated CryptoInstrumentTradingItem data = 3;
}

message CryptoInstrumentMetadata {
  uint64 id = 1;
  string instrument_id = 2;
  uint32 exchange_id = 3;
  string base_ccy = 4;
  string quote_ccy = 5;
  string name_cn = 6;
  string name_en = 7;
  string status = 8;
  string price_precision = 9; // ä»·æ ¼ç²¾åº¦
  string qty_precision = 10;  // æ•°é‡ç²¾åº¦
  uint64 market_cap = 11;
  bool is_contract = 12;

  repeated CryptoTag tags = 13;
}

// --- æé†’/é€šçŸ¥æ¶ˆæ¯ ---
// é€šå¸¸ç”± AlertService æ¨é€ï¼Œç”¨äºå®æ—¶é€šçŸ¥ã€ä»·æ ¼è§¦å‘ã€ç³»ç»Ÿå…¬å‘Šç­‰
message AlertMessage {
  // åŸºç¡€ä¿¡æ¯
  string id = 1;                  // å”¯ä¸€IDï¼ˆUUIDï¼‰
  string title = 2;               // æ ‡é¢˜ï¼Œå¦‚ â€œBTCä»·æ ¼çªç ´70000â€
  string content = 3;             // æ¶ˆæ¯å†…å®¹ï¼Œå¯å±•ç¤ºåœ¨UIä¸­
  string symbol = 4;              // ç›¸å…³å¸ç§ï¼ˆå¯é€‰ï¼‰
  AlertLevel level = 5;           // æ¶ˆæ¯çº§åˆ«ï¼ˆä¿¡æ¯ã€è­¦å‘Šã€ä¸¥é‡ï¼‰
  AlertType alert_type = 6;       // æ¶ˆæ¯ç±»å‹ï¼ˆä»·æ ¼ã€ç³»ç»Ÿã€ç­–ç•¥ã€è‡ªå®šä¹‰ç­‰ï¼‰
  int64 timestamp = 7;            // æœåŠ¡å™¨æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰

  // ğŸš€ è·¯ç”±ä¸è¿½è¸ªå­—æ®µ
  string user_id = 8;             // æ¥æ”¶è€… User ID (Kafka Key)
  string subscription_id = 10;    // è§¦å‘æ­¤æé†’çš„ç”¨æˆ·è®¢é˜… ID (ç”¨äºè¿½è¸ª)
  string related_url = 11;        // ç›¸å…³é“¾æ¥ï¼Œå¦‚äº¤æ˜“å“ˆå¸Œæˆ–æ¨æ–‡é“¾æ¥

  // å¯æ‰©å±•å­—æ®µï¼Œç”¨äºè‡ªå®šä¹‰å±•ç¤ºæˆ–è¡Œä¸º
  map<string, string> extra = 9;  // æ¯”å¦‚ {"trigger_price": "70000", "direction": "up"}

  // ä¿ç•™å­—æ®µï¼Œæœªæ¥æ‰©å±•æ—¶ä¸å½±å“ç°æœ‰å®¢æˆ·ç«¯
  reserved 12 to 19;
}

// --- æ¶ˆæ¯çº§åˆ« ---
enum AlertLevel {
  ALERT_LEVEL_INFO = 0;     // æ™®é€šä¿¡æ¯
  ALERT_LEVEL_WARNING = 1;  // è­¦å‘Š
  ALERT_LEVEL_CRITICAL = 2; // ä¸¥é‡/è‡´å‘½
}

// --- æ¶ˆæ¯ç±»å‹ ---
enum AlertType {
  ALERT_TYPE_SYSTEM = 0;   // ç³»ç»Ÿå…¬å‘Šï¼Œå¦‚â€œç»´æŠ¤é€šçŸ¥â€
  ALERT_TYPE_PRICE = 1;    // è¡Œæƒ…ç±»æé†’ï¼Œå¦‚ä»·æ ¼çªç ´
  ALERT_TYPE_STRATEGY = 2; // ç­–ç•¥ä¿¡å·ç±»æé†’
  ALERT_TYPE_CUSTOM = 3;   // ç”¨æˆ·è‡ªå®šä¹‰æé†’

  // ğŸš€ æ–°å¢çš„æ ¸å¿ƒä¸šåŠ¡æé†’ç±»å‹
  ALERT_TYPE_LISTING = 4;  // äº¤æ˜“å¯¹ä¸Šæ–°/ä¸‹æ¶/è°ƒæ•´
  ALERT_TYPE_ON_CHAIN = 5; // é“¾ä¸Šæé†’ï¼Œå¦‚é²¸é±¼è½¬ç§»ã€å¤§é¢ç¨³å®šå¸é“¸é€ 
  ALERT_TYPE_SOCIAL = 6;   // ç¤¾äº¤åª’ä½“æé†’ï¼Œå¦‚å¤§VæåŠ
}


// --- é€šç”¨æ•°æ®ä½“ï¼ˆæœåŠ¡ç«¯ -> å®¢æˆ·ç«¯ï¼‰---
// è¿™æ˜¯æœ€ç»ˆé€šè¿‡ WebSocket å‘é€ç»™å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä½“ï¼ŒåŒ…å«ä¸€ä¸ª Oneof å­—æ®µ
message WebSocketMessage {
  // æ¶ˆæ¯çš„é€šç”¨ç±»å‹ï¼Œç”¨äºå®¢æˆ·ç«¯å¿«é€Ÿè¯†åˆ«
  string type = 1;

  oneof payload {
    // æ‰¹é‡æ›´æ–°å¤šä¸ªå¸ç§çš„ticker ä»·æ ¼æ•°æ®
    TickerBatch ticker_batch = 2;
    // æ›´æ–°1ä¸ªå¸ç§çš„ticker ä»·æ ¼æ•°æ®
    TickerUpdate ticker = 3;
    // æ›´æ–°kçº¿æ•°æ®
    WsKlineUpdate kline_update = 4;
    // æ›´æ–°å·²æ’åºçš„å¸ç§åˆ—è¡¨
    SortUpdate sort_update = 5;
    // é”™è¯¯æ¶ˆæ¯
    ErrorMessage error_message = 6;
    // äº¤æ˜“å¯¹åˆ—è¡¨æ›´æ–°ï¼Œæ•°æ®æ˜¯æ’åºè¿‡çš„
    InstrumentListUpdate instrument_list = 7;
    // äº¤æ˜“å¯¹æ›´æ–°ï¼ŒåŒ…æ‹¬ä¸Šæ–°å’Œä¸‹æ¶
    InstrumentUpdate instrument_status_update = 8;
    // å¸ç§æ„¿æ•°æ®
    CryptoInstrumentMetadata instrument_metadata = 9;
    // åŒ…å«å¸ç§å’Œæœ€æ–°ä»·æ ¼çš„äº¤æ˜“ä¿¡æ¯é›†åˆ
    CryptoInstrumentTradingArray instrument_trading_list = 10;
    // æé†’/é€šçŸ¥æ¶ˆæ¯
    AlertMessage alert_message = 11;
  }
}